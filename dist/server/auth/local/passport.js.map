{"version":3,"sources":["../../../../server/auth/local/passport.js"],"names":[],"mappings":";;AAAA,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACnC,IAAI,aAAa,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC,QAAQ,CAAC;;AAEvD,SAAS,iBAAiB,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;AACtD,MAAI,CAAC,OAAO,CAAC;AACX,SAAK,EAAE,KAAK,CAAC,WAAW,EAAE;GAC3B,CAAC,CAAC,IAAI,EAAE,CACN,IAAI,CAAC,UAAA,IAAI,EAAI;AACZ,QAAI,CAAC,IAAI,EAAE;AACT,aAAO,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE;AACvB,eAAO,EAAE,+BAA+B;OACzC,CAAC,CAAC;KACJ;AACD,QAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,UAAS,SAAS,EAAE,aAAa,EAAE;AAC7D,UAAI,SAAS,EAAE;AACb,eAAO,IAAI,CAAC,SAAS,CAAC,CAAC;OACxB;AACD,UAAI,CAAC,aAAa,EAAE;AAClB,eAAO,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,OAAO,EAAE,+BAA+B,EAAE,CAAC,CAAC;OACxE,MAAM;AACL,eAAO,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;OACzB;KACF,CAAC,CAAC;GACJ,CAAC,SACI,CAAC,UAAA,GAAG;WAAI,IAAI,CAAC,GAAG,CAAC;GAAA,CAAC,CAAC;CAC5B;;AAED,OAAO,CAAC,KAAK,GAAG,UAAS,IAAI,EAAE,MAAM,EAAE;AACrC,UAAQ,CAAC,GAAG,CAAC,IAAI,aAAa,CAAC;AAC7B,iBAAa,EAAE,OAAO;AACtB,iBAAa,EAAE,UAAU;GAC1B,EAAE,UAAS,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE;AACjC,WAAO,iBAAiB,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAC,CAAC;GACvD,CAAC,CAAC,CAAC;CACL,CAAA","file":"passport.js","sourcesContent":["var passport = require('passport');\nvar LocalStrategy = require('passport-local').Strategy;\n\nfunction localAuthenticate(User, email, password, done) {\n  User.findOne({\n    email: email.toLowerCase()\n  }).exec()\n    .then(user => {\n      if (!user) {\n        return done(null, false, {\n          message: 'This email is not registered.'\n        });\n      }\n      user.authenticate(password, function(authError, authenticated) {\n        if (authError) {\n          return done(authError);\n        }\n        if (!authenticated) {\n          return done(null, false, { message: 'This password is not correct.' });\n        } else {\n          return done(null, user);\n        }\n      });\n    })\n    .catch(err => done(err));\n}\n\nexports.setup = function(User, config) {\n  passport.use(new LocalStrategy({\n    usernameField: 'email',\n    passwordField: 'password' // this is the virtual field on the model\n  }, function(email, password, done) {\n    return localAuthenticate(User, email, password, done);\n  }));\n}\n"]}